<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TA</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./index.js'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TA stands for TrackedActivity</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tools</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'./tools.js'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  3</span> 
<span class='line'>  4</span> 
<span class='line'>  5</span> </span><span class="COMM">/**
<span class='line'>  6</span> * Tests the main functions of the module
<span class='line'>  7</span> */</span><span class="WHIT">
<span class='line'>  8</span> 
<span class='line'>  9</span> </span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">test</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 10</span> 
<span class='line'> 11</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\n\n\nOn teste ci-dessous les fonctions principales du module TrackedActivity.\n\n\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 12</span> 
<span class='line'> 13</span> </span><span class="WHIT">	</span><span class="COMM">/***********Waypoint***********/</span><span class="WHIT">
<span class='line'> 14</span> 
<span class='line'> 15</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'-----Tests pour Waypoint-----\n\n'</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 16</span> 
<span class='line'> 17</span> </span><span class="WHIT">	</span><span class="NAME">SanFrancisco</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TA.Waypoint</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">37.772886</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">122.423771</span><span class="PUNC">,</span><span class="NUMB">0.0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Création de SanFrancisco : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">SanFrancisco</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 20</span> 
<span class='line'> 21</span> </span><span class="WHIT">	</span><span class="NAME">Berkeley</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TA.Waypoint</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">37.871601</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">122.269104</span><span class="PUNC">,</span><span class="NUMB">52200</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nCréation de Berkeley : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">Berkeley</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">	
<span class='line'> 25</span> 	
<span class='line'> 26</span> </span><span class="COMM">/***********Track***********/</span><span class="WHIT">
<span class='line'> 27</span> 
<span class='line'> 28</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\n\n-----Tests pour Track-----\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="WHIT">	
<span class='line'> 30</span> 	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\n On crée un track effectuant un aller-retour entre San Francisco et Berkeley. On considère que l"allure a été de 15 km/h sur tout le trajet (environ 44 km). Normalement, on devrait enregistrer un tableau de points du trajet contenant un point tous les dixièmes de seconde, ce qui en aurait fait 126000. N"ayant pas trouvé d"API fournissant un tel ensemble de points GPS pour un trajet donné, on décide pour l"exemple qui va suivre d"enregistrer un tableau à 3 points : SanFrancisco, Berkeley, et de nouveau SanFrancisco (avec un time différent du premier). Dans la réalité, on récupérerait un tableau de 126000 points dans les données produites par une montre GPS par exemple.\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 31</span> 
<span class='line'> 32</span> </span><span class="WHIT">	</span><span class="NAME">track</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TA.Track</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">SanFrancisco</span><span class="PUNC">,</span><span class="NAME">Berkeley</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Track comportant SanFrancisco comme premier point et Berkeley comme second : \n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">track.waypoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT">	
<span class='line'> 36</span> 	</span><span class="NAME">SanFranciscoBis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TA.Waypoint</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">37.772886</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">122.423771</span><span class="PUNC">,</span><span class="NUMB">126000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">	</span><span class="NAME">track.addPoint</span><span class="PUNC">(</span><span class="NAME">SanFranciscoBis</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nAjout du dernier point (SanFrancisco) : \n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">track.waypoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">	
<span class='line'> 41</span> 	</span><span class="NAME">let</span><span class="WHIT"> </span><span class="NAME">totalDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">track.getTotalDuration</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nDurée totale : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">	</span><span class="NAME">tools.displayTime</span><span class="PUNC">(</span><span class="NAME">totalDuration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">	
<span class='line'> 45</span> 	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nOn ne teste pas getActiveDuration(period,minSpeed). Cette fonction séquence le trajet en portions de durée period et ne garde que les portions où la vitesse était supérieure à minSpeed. Il aurait donc fallu disposer d"un tableau contenant un waypoint tous les dixièmes de seconde du trajet défini. Elle fonctionne néanmoins sur le même principe que getDuration(), qui elle a pu être testée.\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">	
<span class='line'> 47</span> 	</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Pour la distance et la température, cf fonctions asynchrones en bas du terminal.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">	
<span class='line'> 49</span> 	
<span class='line'> 50</span> </span><span class="COMM">/***********Activity***********/</span><span class="WHIT">
<span class='line'> 51</span> 
<span class='line'> 52</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\n\n-----Tests pour Activity-----\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 53</span> 
<span class='line'> 54</span> </span><span class="NAME">activity</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TA.Activity</span><span class="PUNC">(</span><span class="STRN">'running'</span><span class="PUNC">,</span><span class="NAME">track</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 55</span> 
<span class='line'> 56</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Un running qui suit le track déjà créé :\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'> 57</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Type : '</span><span class="PUNC">+</span><span class="NAME">activity.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 58</span> 
<span class='line'> 59</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nTrack : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">activity.track.waypoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 61</span> 
<span class='line'> 62</span> </span><span class="NAME">totalDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">activity.setDurationFromTrack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nDurée de l"activité : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="NAME">tools.displayTime</span><span class="PUNC">(</span><span class="NAME">totalDuration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 65</span> 
<span class='line'> 66</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Types activité possibles : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">TA.Activity.getSportTypes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 68</span> 
<span class='line'> 69</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'L"activité est-elle valide : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">activity.isValid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 71</span> 
<span class='line'> 72</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Le test peut ici échouer à cause d"une donnée manquante : la distance. C"est setDistanceFromTrack() qui lui donne sa valeur, qu"on calcule ici à la fin des tests, avec les autres fonctions asynchrones. Une possibilité serait d"appeler la fonction isValid() dans un .then suivant setDistanceFromTrack(). Mais on ne pourrait alors plus tester la validité quand on le souhaite. On décide donc d"empêcher le test quand la distance n"est pas encore connue.\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 73</span> 
<span class='line'> 74</span> 
<span class='line'> 75</span> </span><span class="COMM">/***********Marathon***********/</span><span class="WHIT">
<span class='line'> 76</span> 
<span class='line'> 77</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\n-----Tests pour Marathon-----\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 78</span> 
<span class='line'> 79</span> </span><span class="NAME">marathon</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TA.Marathon</span><span class="PUNC">(</span><span class="NAME">track</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 80</span> 
<span class='line'> 81</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'On a créé une instance de marathon alors que le track qu"on lui a associé est de plus de 42.195 km. On ne peut pas faire de test à la construction sur la valeur de ce paramètre. On indiquera cette instance comme non valide quand on testera sa validité, si la valeur de sa distance a déjà été calculée.\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 82</span> 
<span class='line'> 83</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Un marathon suivant le track déjà créé :\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'Type : '</span><span class="PUNC">+</span><span class="NAME">marathon.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 85</span> 
<span class='line'> 86</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nTrack : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">marathon.track.waypoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 88</span> 
<span class='line'> 89</span> </span><span class="NAME">totalDuration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">marathon.setDurationFromTrack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nDurée du marathon : '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="NAME">tools.displayTime</span><span class="PUNC">(</span><span class="NAME">totalDuration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 92</span> 
<span class='line'> 93</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\nLe marathon créé est-il valide ? '</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">marathon.isValid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">'\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">	
<span class='line'> 96</span> 	
<span class='line'> 97</span> </span><span class="COMM">/***********Fonctions asynchrones***********/</span><span class="WHIT">
<span class='line'> 98</span> 
<span class='line'> 99</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'\n-----Tests des fonctions asynchrones-----\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>100</span> 
<span class='line'>101</span> </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">'4 résultats : la distance du track, la température de son premier point, la distance de l"activité à partir de son track, et la distance du marathon à partir de son track (l"affichage indique "activity" dans les deux cas, inutile de redéfinir la fonction juste pour pouvoir lire "marathon" le cas échéant).\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>102</span> 
<span class='line'>103</span> </span><span class="NAME">track.getDistance</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span> 
<span class='line'>105</span> </span><span class="NAME">track.getTemperature</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>106</span> 
<span class='line'>107</span> </span><span class="NAME">activity.setDistanceFromTrack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>108</span> 
<span class='line'>109</span> </span><span class="NAME">marathon.setDistanceFromTrack</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>110</span> 
<span class='line'>111</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>112</span> 
<span class='line'>113</span> </span><span class="NAME">test</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>114</span> 
<span class='line'>115</span> 
<span class='line'>116</span> 
<span class='line'>117</span> 
<span class='line'>118</span> 
<span class='line'>119</span> </span></pre></body></html>